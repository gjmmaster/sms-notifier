name: Manter Reposit√≥rio Ativo

on:
  schedule:
    - cron: '0 0 * * 0'  # Todo domingo √† meia-noite UTC
  workflow_dispatch:

permissions:
  contents: write

jobs:
  keepalive:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Verificar e criar keepalive
        run: |
          echo "üîç Verificando √∫ltima atividade do reposit√≥rio..."
          
          # Obter data do √∫ltimo commit
          LAST_COMMIT_DATE=$(git log -1 --format=%ct)
          CURRENT_DATE=$(date +%s)
          DAYS_DIFF=$(( (CURRENT_DATE - LAST_COMMIT_DATE) / 86400 ))
          
          echo "√öltimo commit h√° $DAYS_DIFF dias"
          
          # Se inativo por mais de 45 dias, criar commit keepalive
          if [ $DAYS_DIFF -gt 45 ]; then
            echo "üìù Reposit√≥rio inativo h√° mais de 45 dias. Criando keepalive..."
            
            # Configurar git
            git config --local user.email "action@github.com"
            git config --local user.name "GitHub Action"
            
            # Criar arquivo keepalive
            echo "Last keepalive: $(date)" > .github/keepalive
            
            # Commit e push
            git add .github/keepalive
            git commit -m "chore: keepalive autom√°tico para manter reposit√≥rio ativo"
            git push
            
            echo "‚úÖ Keepalive criado com sucesso!"
          else
            echo "‚úÖ Reposit√≥rio ainda ativo. Nenhuma a√ß√£o necess√°ria."
          fi
